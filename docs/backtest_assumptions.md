# 回测假设说明

本文档说明LazyBull回测系统的核心假设、简化与局限性。

## 1. 价格执行假设

### 1.1 成交价格

**当前实现**:
- **调仓日成交价**: 使用当日收盘价
- **假设**: 可以在收盘价附近完成所有交易

**简化点**:
- 未考虑盘中价格波动
- 未考虑大单冲击成本
- 未考虑流动性约束

**未来改进方向** (TODO):
- 使用次日开盘价（更真实）
- 加入市场冲击模型
- 考虑流动性限制（成交量占比）

### 1.2 滑点模型

**当前实现**:
- 固定滑点比例: 0.1% (可配置)
- 买卖双向均计入

**假设**:
- 滑点与成交量无关
- 市场流动性充足

## 2. 交易成本

### 2.1 佣金

- **费率**: 万分之3（双向）
- **最低**: 5元/笔
- **假设**: 费率固定，不随券商或资金量变化

### 2.2 印花税

- **费率**: 千分之1
- **方向**: 仅卖出
- **假设**: 税率保持不变（实际可能政策调整）

### 2.3 未包含的成本

以下成本当前**未计入**，在精细化阶段需补充：
- 融资融券利息
- 过户费（上交所，极小可忽略）
- 市场冲击成本
- 机会成本

## 3. 交易限制

### 3.1 涨跌停

**当前实现**: ❌ 未实现  
**影响**: 可能高估策略表现

**假设**:
- 所有股票均可正常买卖
- 不存在涨停买不进、跌停卖不出的情况

**TODO**:
- 添加涨跌停判断逻辑
- 涨停日：禁止买入
- 跌停日：禁止卖出，或按跌停价挂单延后成交

### 3.2 停牌

**当前实现**: ❌ 未实现  
**影响**: 可能出现持仓停牌股票无法平仓

**假设**:
- 股票不会停牌
- 所有交易指令均可立即执行

**TODO**:
- 加入停牌数据源
- 停牌期间：持仓冻结，不可交易
- 复牌后按规则处理

### 3.3 买卖单位

**当前实现**: ✅ 已实现  
- 按100股（1手）取整
- 不足1手部分舍弃

### 3.4 T+1制度

**当前实现**: ❌ 简化忽略  
**影响**: 对日内交易策略影响较大，对周/月频策略影响有限

**假设**:
- 当日买入的股票当日可卖出（实际需T+1）

**TODO** (低优先级):
- 对高频策略需实现T+1约束

## 4. 数据假设

### 4.1 数据质量

**假设**:
- 历史数据完整无误
- 财务数据无重述调整
- 不存在未来函数（前视偏差）

**注意**:
- TuShare数据可能存在错误或延迟
- 部分退市股票数据缺失
- 建议对数据进行质量检查

### 4.2 公司行为

**当前实现**: ❌ 未实现

未考虑以下事件对回测的影响：
- 除权除息（分红、送股）
- 配股
- 增发
- 股票拆分/合并
- 退市

**TODO**:
- 加入复权处理
- 处理公司行为事件

## 5. 再平衡假设

### 5.1 调仓频率

**当前实现**:
- 支持日(D)、周(W)、月(M)频
- 月频：每月最后一个交易日
- 周频：每周最后一个交易日

**假设**:
- 可在指定日期完全完成调仓
- 不考虑分批调仓

### 5.2 资金使用

**假设**:
- 现金不生息（实际可购买货币基金）
- 满仓运行，无现金留存约束

**TODO**:
- 加入现金收益（如1.5%年化）
- 支持仓位控制（非满仓运行）

## 6. 组合约束

### 6.1 单股权重

**当前实现**:
- 等权：1/N
- 因子加权：按得分比例

**未实现**:
- 单股权重上下限
- 行业权重限制
- 换手率限制

### 6.2 市值容量

**假设**:
- 资金量不受限
- 可买入任意股票

**实际**:
- 大资金需考虑流动性
- 小市值股票容量有限

## 7. 基准与归因

### 7.1 基准选择

**默认基准**: 沪深300 (000300.SH)

**假设**:
- 基准可完全复制
- 不考虑基准跟踪成本

### 7.2 风险模型

**当前实现**: 简化  
- 仅计算波动率、最大回撤、夏普比率
- 未实现完整风险分解（如Barra模型）

**TODO**:
- 行业暴露分析
- 风格因子暴露
- 风险归因

## 8. 市场假设

### 8.1 市场环境

**假设**:
- 市场正常运行，无极端系统性风险
- 不考虑熔断、全市场停牌等黑天鹅事件

### 8.2 制度环境

**假设**:
- 交易制度、税率保持不变
- 不考虑政策变化影响（如印花税调整）

## 9. 回测框架局限

### 9.1 过拟合风险

- 参数优化可能导致过拟合
- 建议：样本外测试、参数稳健性检验

### 9.2 幸存者偏差

- 当前股票池基于最新上市股票
- 未包含已退市股票
- **影响**: 可能高估历史表现

### 9.3 前视偏差

- 需确保所有数据在决策时点可获得
- 注意财报发布时间、因子计算时点

## 10. 改进路线图

### MVP阶段（当前）
- [x] 基础回测框架
- [x] 简化成本模型
- [x] 月频调仓
- [ ] 涨跌停处理

### 增强真实度阶段
- [ ] 次日开盘价成交
- [ ] 停牌处理
- [ ] 复权处理
- [ ] 公司行为处理
- [ ] 流动性约束

### 精细化阶段
- [ ] 市场冲击模型
- [ ] 风险模型与归因
- [ ] 实时滑点调整
- [ ] 多因子组合优化

## 参考资料

- QuantConnect回测假设文档
- Backtrader回测引擎文档
- 国内量化平台（如聚宽、米筐）回测说明

## 版本历史

- v0.1.0 (2024-01): 初始版本，定义基础假设与局限
