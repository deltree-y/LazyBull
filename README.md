# LazyBull - Aè‚¡é‡åŒ–ç ”ç©¶ä¸å›æµ‹æ¡†æ¶

<div align="center">

**ä¸“æ³¨ä»·å€¼çº¢åˆ©ç­–ç•¥çš„é‡åŒ–æŠ•èµ„æ¡†æ¶**

[![Python](https://img.shields.io/badge/Python-3.9.13-blue.svg)](https://www.python.org/)
[![TensorFlow](https://img.shields.io/badge/TensorFlow-2.10-orange.svg)](https://www.tensorflow.org/)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)

[åŠŸèƒ½ç‰¹æ€§](#åŠŸèƒ½ç‰¹æ€§) â€¢ [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹) â€¢ [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„) â€¢ [æ–‡æ¡£](#æ–‡æ¡£) â€¢ [è·¯çº¿å›¾](#è·¯çº¿å›¾)

</div>

---

## ğŸ“– é¡¹ç›®ç®€ä»‹

LazyBull æ˜¯ä¸€ä¸ªè½»é‡çº§çš„Aè‚¡é‡åŒ–ç ”ç©¶ä¸å›æµ‹æ¡†æ¶ï¼Œä¸“æ³¨äº**ä»·å€¼çº¢åˆ©**æ–¹å‘çš„ç­–ç•¥ç ”ç©¶ã€‚é¡¹ç›®æ”¯æŒä»æœ¬åœ°å¼€å‘åˆ°äº‘ç«¯è‡ªåŠ¨åŒ–è¿è¡Œçš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸï¼Œå¼ºè°ƒ**å¯å¤ç°æ€§**å’Œ**å¯è¿ç§»æ€§**ã€‚

### æ ¸å¿ƒç†å¿µ
- ğŸ¯ **ä¸“æ³¨ä»·å€¼çº¢åˆ©**: èšç„¦é«˜è‚¡æ¯ç‡ã€ä½ä¼°å€¼ç­–ç•¥
- ğŸ“Š **æ•°æ®é©±åŠ¨**: åŸºäºTuShare Proæ¥å£è·å–å…¨é¢æ•°æ®
- ğŸ”„ **å‘¨é¢‘/æœˆé¢‘**: é€‚åˆä¸­é•¿æœŸæŒä»“ï¼Œé™ä½äº¤æ˜“æˆæœ¬
- â˜ï¸ **äº‘ç«¯å‹å¥½**: æ˜“äºéƒ¨ç½²åˆ°äº‘ç«¯å®šæ—¶ä»»åŠ¡
- ğŸ‡¨ğŸ‡³ **ä¸­æ–‡ä¼˜å…ˆ**: ä»£ç æ³¨é‡Šã€æ–‡æ¡£å‡ä½¿ç”¨ä¸­æ–‡

---

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### å½“å‰ç‰ˆæœ¬ (v0.1.0 - MVP)

- âœ… **å®Œæ•´çš„é¡¹ç›®éª¨æ¶**: æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±•
- âœ… **TuShareæ•°æ®æ¥å…¥**: è‡ªåŠ¨æ‹‰å–äº¤æ˜“æ—¥å†ã€è‚¡ç¥¨åˆ—è¡¨ã€æ—¥çº¿è¡Œæƒ…ã€è´¢åŠ¡æŒ‡æ ‡
- âœ… **Parquetå­˜å‚¨**: é«˜æ•ˆçš„åˆ—å¼å­˜å‚¨ï¼ŒåŠ é€Ÿæ•°æ®è¯»å–
- âœ… **å›æµ‹å¼•æ“**: æ”¯æŒæ—¥/å‘¨/æœˆé¢‘è°ƒä»“ï¼ŒåŒ…å«æˆæœ¬æ¨¡å‹
- âœ… **ä¿¡å·ç”Ÿæˆ**: æä¾›ç­‰æƒã€å› å­æ‰“åˆ†ç­‰å¤šç§æ–¹æ³•
- âœ… **æŠ¥å‘Šç”Ÿæˆ**: è‡ªåŠ¨è®¡ç®—æ”¶ç›Šç‡ã€å¤æ™®ã€æœ€å¤§å›æ’¤ç­‰æŒ‡æ ‡
- âœ… **å•å…ƒæµ‹è¯•**: åŸºäºpytestçš„æµ‹è¯•æ¡†æ¶

### è®¡åˆ’åŠŸèƒ½ (Roadmap)

- ğŸ”² æ¶¨è·Œåœ/åœç‰Œå¤„ç†
- ğŸ”² å¤æƒå¤„ç†
- ğŸ”² å®Œæ•´çš„ä»·å€¼çº¢åˆ©å› å­åº“
- ğŸ”² ç»„åˆä¼˜åŒ–ä¸é£é™©ç®¡ç†
- ğŸ”² äº‘ç«¯å®šæ—¶ä»»åŠ¡
- ğŸ”² å®ç›˜æ¥å£ï¼ˆé•¿æœŸï¼‰

è¯¦è§ [é¡¹ç›®è·¯çº¿å›¾](docs/roadmap.md)

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python: 3.9.13
- TensorFlow: 2.10 (ä¸å¯å‡çº§)
- æ“ä½œç³»ç»Ÿ: Linux/macOS/Windows

### æ–¹å¼ä¸€: ä½¿ç”¨Poetryå®‰è£…ï¼ˆæ¨èï¼‰

```bash
# 1. å…‹éš†ä»“åº“
git clone https://github.com/deltree-y/LazyBull.git
cd LazyBull

# 2. å®‰è£…Poetry (å¦‚æœªå®‰è£…)
curl -sSL https://install.python-poetry.org | python3 -

# 3. å®‰è£…ä¾èµ–
poetry install

# 4. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
poetry shell
```

### æ–¹å¼äºŒ: ä½¿ç”¨pipå®‰è£…

```bash
# 1. å…‹éš†ä»“åº“
git clone https://github.com/deltree-y/LazyBull.git
cd LazyBull

# 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 3. å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### é…ç½®TuShare Token

```bash
# 1. å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env

# 2. ç¼–è¾‘.envæ–‡ä»¶ï¼Œå¡«å…¥ä½ çš„TuShare token
# TS_TOKEN=your_tushare_token_here

# è·å–token: https://tushare.pro/register
```

### è¿è¡Œç¤ºä¾‹

```bash
# 1. æ‹‰å–æ•°æ® (éœ€è¦TuShare token)
python scripts/pull_data.py

# 2. æ„å»ºç‰¹å¾ (æ—¥é¢‘æˆªé¢ç‰¹å¾ + 5æ—¥æ ‡ç­¾)
python scripts/build_features.py --start_date 20230101 --end_date 20231231

# æˆ–è€…ä¸€æ­¥å®Œæˆï¼ˆè‡ªåŠ¨æ‹‰å–æ•°æ®å¹¶æ„å»ºç‰¹å¾ï¼‰
python scripts/build_features.py --start_date 20230101 --end_date 20231231 --pull_data

# 3. è¿è¡Œå›æµ‹ (å¦‚æ— æ•°æ®ä¼šä½¿ç”¨mockæ•°æ®æ¼”ç¤º)
python scripts/run_backtest.py

# 4. æŸ¥çœ‹æŠ¥å‘Šå’Œç‰¹å¾
ls data/reports/
ls data/features/cs_train/
```

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest

# è¿è¡Œç‰¹å®šæµ‹è¯•
pytest tests/test_cost.py
pytest tests/test_features.py

# æŸ¥çœ‹è¦†ç›–ç‡
pytest --cov=src/lazybull --cov-report=html
```

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
LazyBull/
â”œâ”€â”€ configs/                    # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ base.yaml              # åŸºç¡€é…ç½®
â”‚   â”œâ”€â”€ strategy_dividend_value.yaml  # çº¢åˆ©ä»·å€¼ç­–ç•¥é…ç½®
â”‚   â”œâ”€â”€ runtime_local.yaml     # æœ¬åœ°è¿è¡Œé…ç½®
â”‚   â””â”€â”€ runtime_cloud.yaml     # äº‘ç«¯è¿è¡Œé…ç½®
â”œâ”€â”€ data/                       # æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ raw/                   # åŸå§‹æ•°æ®ï¼ˆæ”¯æŒæŒ‰æ—¥åˆ†åŒºï¼‰
â”‚   â”‚   â””â”€â”€ {name}/            # æŒ‰æ—¥åˆ†åŒº: YYYY-MM-DD.parquet
â”‚   â”œâ”€â”€ clean/                 # æ¸…æ´—åæ•°æ®ï¼ˆæ”¯æŒæŒ‰æ—¥åˆ†åŒºï¼‰
â”‚   â”‚   â””â”€â”€ {name}/            # æŒ‰æ—¥åˆ†åŒº: YYYY-MM-DD.parquet
â”‚   â”œâ”€â”€ features/              # ç‰¹å¾æ•°æ®
â”‚   â””â”€â”€ reports/               # å›æµ‹æŠ¥å‘Š
â”œâ”€â”€ docs/                       # æ–‡æ¡£
â”‚   â”œâ”€â”€ data_contract.md       # æ•°æ®å¥‘çº¦
â”‚   â”œâ”€â”€ backtest_assumptions.md # å›æµ‹å‡è®¾
â”‚   â””â”€â”€ roadmap.md             # è·¯çº¿å›¾
â”œâ”€â”€ scripts/                    # è„šæœ¬
â”‚   â”œâ”€â”€ pull_data.py           # æ•°æ®æ‹‰å–
â”‚   â”œâ”€â”€ build_features.py      # ç‰¹å¾æ„å»º
â”‚   â””â”€â”€ run_backtest.py        # è¿è¡Œå›æµ‹
â”œâ”€â”€ src/lazybull/              # æºä»£ç 
â”‚   â”œâ”€â”€ common/                # é€šç”¨æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ config.py          # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ logger.py          # æ—¥å¿—å·¥å…·
â”‚   â”‚   â””â”€â”€ cost.py            # æˆæœ¬æ¨¡å‹
â”‚   â”œâ”€â”€ data/                  # æ•°æ®æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ tushare_client.py  # TuShareå®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ storage.py         # æ•°æ®å­˜å‚¨
â”‚   â”‚   â””â”€â”€ loader.py          # æ•°æ®åŠ è½½
â”‚   â”œâ”€â”€ universe/              # è‚¡ç¥¨æ± æ¨¡å—
â”‚   â”‚   â””â”€â”€ base.py            # è‚¡ç¥¨æ± åŸºç±»
â”‚   â”œâ”€â”€ factors/               # å› å­æ¨¡å— (TODO)
â”‚   â”œâ”€â”€ signals/               # ä¿¡å·æ¨¡å—
â”‚   â”‚   â””â”€â”€ base.py            # ä¿¡å·åŸºç±»
â”‚   â”œâ”€â”€ portfolio/             # ç»„åˆç®¡ç† (TODO)
â”‚   â”œâ”€â”€ execution/             # æ‰§è¡Œæ¨¡å— (TODO)
â”‚   â”œâ”€â”€ backtest/              # å›æµ‹æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ engine.py          # å›æµ‹å¼•æ“
â”‚   â”‚   â””â”€â”€ reporter.py        # æŠ¥å‘Šç”Ÿæˆ
â”‚   â””â”€â”€ live/                  # å®ç›˜æ¨¡å— (TODO)
â”œâ”€â”€ tests/                      # æµ‹è¯•
â”‚   â”œâ”€â”€ conftest.py            # pytesté…ç½®
â”‚   â”œâ”€â”€ test_config.py         # é…ç½®æµ‹è¯•
â”‚   â”œâ”€â”€ test_cost.py           # æˆæœ¬æ¨¡å‹æµ‹è¯•
â”‚   â””â”€â”€ test_calendar.py       # æ—¥å†æµ‹è¯•
â”œâ”€â”€ .env.example               # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ .gitignore                 # Gitå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ pyproject.toml             # Poetryé…ç½®
â”œâ”€â”€ requirements.txt           # pipä¾èµ–
â””â”€â”€ README.md                  # æœ¬æ–‡ä»¶
```

---

## ğŸ“š æ–‡æ¡£

- [æ•°æ®å¥‘çº¦](docs/data_contract.md): å„æ•°æ®å±‚çš„å­—æ®µè§„èŒƒä¸ä¸»é”®çº¦å®š
- [å›æµ‹å‡è®¾](docs/backtest_assumptions.md): å›æµ‹ç³»ç»Ÿçš„å‡è®¾ã€ç®€åŒ–ä¸å±€é™æ€§
- [ç‰¹å¾ä¸æ ‡ç­¾å®šä¹‰](docs/features_schema.md): æ—¥é¢‘ç‰¹å¾æ„å»ºã€æ ‡ç­¾è®¡ç®—ã€è¿‡æ»¤è§„åˆ™è¯´æ˜
- [é¡¹ç›®è·¯çº¿å›¾](docs/roadmap.md): åˆ†é˜¶æ®µå¼€å‘è®¡åˆ’

---

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### 1. æ‹‰å–æ•°æ®

```python
from src.lazybull.data import TushareClient, Storage

# åˆå§‹åŒ–å®¢æˆ·ç«¯
client = TushareClient()  # ä»ç¯å¢ƒå˜é‡è¯»å–TS_TOKEN
storage = Storage()

# æ‹‰å–äº¤æ˜“æ—¥å†
trade_cal = client.get_trade_cal("20230101", "20231231")
storage.save_raw(trade_cal, "trade_cal")

# æ‹‰å–è‚¡ç¥¨åˆ—è¡¨
stock_basic = client.get_stock_basic()
storage.save_raw(stock_basic, "stock_basic")
```

### 2. æ„å»ºæ—¥é¢‘ç‰¹å¾ä¸æ ‡ç­¾

```python
from src.lazybull.data import DataLoader, Storage
from src.lazybull.features import FeatureBuilder

# åˆå§‹åŒ–
storage = Storage()
loader = DataLoader(storage)
builder = FeatureBuilder(
    min_list_days=60,  # æœ€å°ä¸Šå¸‚60å¤©
    horizon=5          # é¢„æµ‹æœªæ¥5ä¸ªäº¤æ˜“æ—¥
)

# åŠ è½½æ•°æ®
trade_cal = loader.load_trade_cal()
stock_basic = loader.load_stock_basic()
daily_data = storage.load_raw("daily")
adj_factor = storage.load_raw("adj_factor")

# æ„å»ºå•æ—¥ç‰¹å¾
features = builder.build_features_for_day(
    trade_date='20230110',
    trade_cal=trade_cal,
    daily_data=daily_data,
    adj_factor=adj_factor,
    stock_basic=stock_basic
)

# ä¿å­˜ç‰¹å¾
storage.save_cs_train_day(features, '20230110')

# åŠ è½½ç‰¹å¾
features = storage.load_cs_train_day('20230110')
print(f"æ ·æœ¬æ•°: {len(features)}")
print(f"ç‰¹å¾åˆ—: {features.columns.tolist()}")
```

### 3. æ„å»ºè‚¡ç¥¨æ± 

```python
from src.lazybull.universe import BasicUniverse
from src.lazybull.data import DataLoader
import pandas as pd

# åŠ è½½æ•°æ®
loader = DataLoader()
stock_basic = loader.load_stock_basic()

# åˆ›å»ºè‚¡ç¥¨æ± 
universe = BasicUniverse(
    stock_basic=stock_basic,
    exclude_st=True,          # æ’é™¤ST
    min_list_days=252,        # è‡³å°‘ä¸Šå¸‚1å¹´
    markets=['ä¸»æ¿', 'åˆ›ä¸šæ¿']  # é™å®šå¸‚åœº
)

# è·å–æŸæ—¥è‚¡ç¥¨æ± 
stocks = universe.get_stocks(pd.Timestamp('2023-12-31'))
print(f"è‚¡ç¥¨æ± å¤§å°: {len(stocks)}")
```

### 4. è¿è¡Œå›æµ‹

```python
from src.lazybull.backtest import BacktestEngine, Reporter
from src.lazybull.signals import EqualWeightSignal
from src.lazybull.common.cost import CostModel

# åˆå§‹åŒ–ç»„ä»¶
signal = EqualWeightSignal(top_n=30)  # ç­‰æƒ30åª
cost_model = CostModel()

engine = BacktestEngine(
    universe=universe,
    signal=signal,
    initial_capital=1000000,
    cost_model=cost_model,
    rebalance_freq="M"  # æœˆåº¦è°ƒä»“
)

# è¿è¡Œå›æµ‹
nav_curve = engine.run(
    start_date=pd.Timestamp('2023-01-01'),
    end_date=pd.Timestamp('2023-12-31'),
    trading_dates=trading_dates,
    price_data=daily_data
)

# ç”ŸæˆæŠ¥å‘Š
reporter = Reporter()
trades = engine.get_trades()
stats = reporter.generate_report(nav_curve, trades)
```

---

## ğŸ”§ é…ç½®è¯´æ˜

### é…ç½®æ–‡ä»¶å±‚çº§

é…ç½®é‡‡ç”¨ç»§æ‰¿æœºåˆ¶ï¼ŒååŠ è½½çš„é…ç½®ä¼šè¦†ç›–å…ˆåŠ è½½çš„ï¼š

```
base.yaml (åŸºç¡€é…ç½®)
  â†“
strategy_dividend_value.yaml (ç­–ç•¥é…ç½®)
  â†“
runtime_local.yaml æˆ– runtime_cloud.yaml (è¿è¡Œæ—¶é…ç½®)
```

### ä¸»è¦é…ç½®é¡¹

```yaml
# configs/base.yaml
data:
  root: "./data"

backtest:
  start_date: "20200101"
  end_date: "20231231"
  initial_capital: 1000000
  rebalance_frequency: "M"

costs:
  commission_rate: 0.0003    # ä¸‡3ä½£é‡‘
  min_commission: 5          # æœ€ä½5å…ƒ
  stamp_tax: 0.001           # åƒ1å°èŠ±ç¨
  slippage: 0.001            # 0.1%æ»‘ç‚¹
```

---

## ğŸ§ª å¼€å‘æŒ‡å—

### æ·»åŠ æ–°å› å­

```python
# åœ¨ src/lazybull/factors/ ä¸­åˆ›å»ºæ–°æ–‡ä»¶
class MyFactor:
    def calculate(self, data):
        # å®ç°å› å­è®¡ç®—é€»è¾‘
        pass
```

### æ·»åŠ æ–°ç­–ç•¥

```python
# ç»§æ‰¿ Signal åŸºç±»
from src.lazybull.signals.base import Signal

class MyStrategy(Signal):
    def generate(self, date, universe, data):
        # å®ç°ä¿¡å·ç”Ÿæˆé€»è¾‘
        return {stock: weight for stock, weight in ...}
```

### ä»£ç é£æ ¼

- ä½¿ç”¨ Black æ ¼å¼åŒ–: `black src/ tests/`
- ä½¿ç”¨ isort æ’åºå¯¼å…¥: `isort src/ tests/`
- ä½¿ç”¨ flake8 æ£€æŸ¥: `flake8 src/ tests/`

---

## ğŸ“Š å›æµ‹ç¤ºä¾‹è¾“å‡º

```
============================================================
å›æµ‹æŠ¥å‘Šæ‘˜è¦
============================================================
æ€»æ”¶ç›Šç‡      : 15.23%
å¹´åŒ–æ”¶ç›Šç‡    : 15.50%
æœ€å¤§å›æ’¤      : -8.45%
æ³¢åŠ¨ç‡        : 12.30%
å¤æ™®æ¯”ç‡      : 1.25
äº¤æ˜“æ¬¡æ•°      : 24
æ€»äº¤æ˜“æˆæœ¬    : 12345.67å…ƒ
å›æµ‹å¤©æ•°      : 252
èµ·å§‹å‡€å€¼      : 1.0000
ç»“æŸå‡€å€¼      : 1.1523
============================================================
```

---

## âš ï¸ é£é™©æç¤º

1. **å†å²å›æµ‹ä¸ä»£è¡¨æœªæ¥**: è¿‡å»çš„è¡¨ç°ä¸é¢„ç¤ºæœªæ¥æ”¶ç›Š
2. **æ•°æ®è´¨é‡**: TuShareæ•°æ®å¯èƒ½å­˜åœ¨é”™è¯¯æˆ–å»¶è¿Ÿ
3. **ç®€åŒ–å‡è®¾**: å½“å‰ç‰ˆæœ¬å­˜åœ¨å¤šé¡¹ç®€åŒ–ï¼ˆè¯¦è§ [å›æµ‹å‡è®¾](docs/backtest_assumptions.md)ï¼‰
4. **ä»…ä¾›ç ”ç©¶**: æœ¬é¡¹ç›®ä»…ç”¨äºé‡åŒ–ç ”ç©¶å­¦ä¹ ï¼Œä¸æ„æˆæŠ•èµ„å»ºè®®

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

### è´¡çŒ®æµç¨‹

1. Forkæœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯Pull Request

### å¼€å‘è§„èŒƒ

- æ‰€æœ‰ä»£ç éœ€é€šè¿‡æµ‹è¯•
- ä¿æŒæµ‹è¯•è¦†ç›–ç‡ > 80%
- éµå¾ªç°æœ‰ä»£ç é£æ ¼
- æ›´æ–°ç›¸å…³æ–‡æ¡£

---

## ğŸ“„ License

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

---

## ğŸ“® è”ç³»æ–¹å¼

- ä½œè€…: deltree-y
- é¡¹ç›®åœ°å€: [https://github.com/deltree-y/LazyBull](https://github.com/deltree-y/LazyBull)
- Issueåé¦ˆ: [https://github.com/deltree-y/LazyBull/issues](https://github.com/deltree-y/LazyBull/issues)

---

## ğŸ™ è‡´è°¢

- [TuShare](https://tushare.pro/): ä¼˜ç§€çš„è´¢ç»æ•°æ®æ¥å£
- [Backtrader](https://www.backtrader.com/): å›æµ‹æ¡†æ¶è®¾è®¡å‚è€ƒ
- æ‰€æœ‰å¼€æºç¤¾åŒºçš„è´¡çŒ®è€…

---

<div align="center">

**â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿Staræ”¯æŒï¼**

Made with â¤ï¸ by deltree-y

</div>
